<%# TODO: 修正する%>
<%= link_to ">>戻る", contents_path, class:"blue-link" %>

<% if admin_user? %>
  <%= link_to ">>編集", edit_content_path, class:"admin-link" %>
  <%# TODO: アラートにデザインを当てる %>
  <%= link_to ">>削除", content_path(@content), data: { confirm: '削除してもよろしいでしょうか？'}, method: :delete, class:"admin-link" %>
<% end %>

<!-- movie -->
<div>
  <%= embed_youtube(@content.movie_url) %>
</div>

<!-- 説明 -->
<p>タイトル:<%= @content.title %></p>
<p>サブタイトル:<%= @content. subtitle %></p>
<p>コメント:<%= @content.comment %></p>

<!-- タグ -->
<h2 class="h2">タグ</h2>
<div>
  <% @content.tag_masters.each do |tag| %>
    <span class="content-tag-btn">
      <%= tag.tag_name %>
    </span>
  <% end %>
</div>

<!-- お気に入り -->
<%#= render partial: "favorite_card", collection: @makes, as: "make" %>

<div if="content-<%= @content.id %>">


<br/>

  <%# TODO: 条件分岐をリファクタリングすること%>
  <% if user_signed_in? %>
    <div class="my-4">
      <% if @content.favorited_by?(current_user) %>
        <%# お気に入りから外す %>
        <%= link_to "お気に入り", content_favorites_path(@content), method: :delete, remote: true, class:"favorite-btn" %>
      <% else %>
        <%# お気に入りに追加 %>
        <%= link_to "お気に入りする", content_favorites_path(@content), method: :post, remote: true, class:"no-favorite-btn" %>
      <% end %>
    </div>
  <% end %>
</div>
<p>お気に入り数:<%= @content.favorites.count %></p>

<br/>

<!-- 材料 -->
<div class="mb-4">
  <h2 class="h2">材料</h2>
  <% if admin_user? %>
    <%= link_to ">>追加", new_material_path(params: { content_id: @content.id }), class:"admin-link"%>
  <% end %>
  <!-- 材料一覧 -->
  <%= render partial: "material_card", collection: @materials, as: "material" %>
</div>


<!-- 作り方 -->
<div class="mb-4">
  <h2 class="h2">作り方</h2>
  <% if admin_user? %>
    <%= link_to ">>追加", new_make_path(params: { content_id: @content.id }), class:"admin-link" %>
  <% end %>
  <!-- 作り方一覧 -->
  <%= render partial: "make_card", collection: @makes, as: "make" %>
</div>  

<!-- ポイント -->
<h2 class="h2">ポイント</h2>
<p>コメント:<%= @content.point %></p>

<br/>


<!-- review -->
<div class="mb-4">
  <h2 class="h2">レビュー</h2>
  <% if general_user? %>
    <%= link_to ">>レビューする", new_review_path(params: { content_id: @content.id }), class:"blue-link" %>
  <% end %>

  <!-- レビュー一覧-->
  <div class="md:flex justify-center">
    <%= render partial: "review_card", collection: @reviews, as: "review" %>
  </div>
</div>  


<!-- 質問 -->
<h2 class="h2">質問する</h2>

<!-- 質問フォーム -->
<% if user_signed_in? %>
  <% if current_user.general? %>
    <%= render "question_form" %>
  <% else %>
    <p>管理者は質問できません。</p>
  <% end %>
<% else %>
  <p>ログインすると、質問ができます</p>
<% end %>
<br/>

<!-- 質問と返信 -->
<h2 class="h2">質問</h2>
<%= render partial: "question_card", collection: @questions, as: "question" %>


<%# TODO: jqueryでアコーディオンを検討(長くなるので) %>